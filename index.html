<!DOCTYPE html>
<html>
<head>
    <title>Аниме Счётчик Кликов</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #ffebf3;
            background-image: url('https://i.imgur.com/X6QX0yT.png');
            background-size: cover;
            color: #5a2d69;
        }
        
        .container {
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 15px;
            padding: 25px;
            max-width: 400px;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(234, 76, 137, 0.4);
            border: 2px solid #ff4d88;
        }
        
        h1 {
            color: #d23369;
            text-shadow: 2px 2px 4px rgba(210, 51, 105, 0.3);
            font-size: 28px;
            margin-bottom: 20px;
        }
        
        .counter-display {
            font-size: 36px;
            font-weight: bold;
            margin: 20px 0;
            color: #9c27b0;
            text-shadow: 1px 1px 3px rgba(156, 39, 176, 0.3);
            background-color: rgba(255, 228, 241, 0.7);
            padding: 10px;
            border-radius: 10px;
            border: 1px dashed #ff80ab;
        }
        
        .click-button {
            padding: 12px 25px;
            background: linear-gradient(145deg, #ff4081, #c2185b);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(194, 24, 91, 0.3);
            transition: all 0.3s;
        }
        
        .click-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(194, 24, 91, 0.4);
        }
        
        .click-button:active {
            transform: translateY(1px);
            background: linear-gradient(145deg, #c2185b, #ff4081);
        }
        
        .reset-button {
            padding: 10px 20px;
            background: linear-gradient(145deg, #7b1fa2, #4a148c);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            box-shadow: 0 4px 8px rgba(123, 31, 162, 0.3);
            transition: all 0.3s;
        }
        
        .reset-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(123, 31, 162, 0.4);
        }
        
        .character {
            width: 120px;
            margin: 20px auto;
            transition: all 0.5s;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f44336;
            opacity: 0;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Аниме Счётчик Кликов ✨</h1>
        
        <div class="character floating">
            <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="40" r="30" fill="#ffcdd2"/>
                <circle cx="38" cy="35" r="5" fill="#5a2d69"/>
                <circle cx="62" cy="35" r="5" fill="#5a2d69"/>
                <path d="M40 50 Q50 60 60 50" stroke="#5a2d69" stroke-width="2" fill="none"/>
            </svg>
        </div>
        
        <div class="counter-display">
            Кликов: <span id="clickCount">0</span>
        </div>
        
        <button class="click-button" id="clickButton">Клик-Клик!</button>
        <button class="reset-button" id="resetButton">Обнулить</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        let clickCounter = 0;
        let isDataLoaded = false;

        // Инициализация
        tg.ready();
        tg.expand();
        tg.MainButton.show()
            .setText("Закрыть")
            .onClick(() => saveCounter(() => tg.close()));

        // Загрузка сохранённых данных
        function loadCounter() {
            tg.CloudStorage.getItem('clickCount', (error, savedValue) => {
                if (!error && savedValue !== null) {
                    clickCounter = parseInt(savedValue) || 0;
                }
                updateCounterDisplay();
                isDataLoaded = true;
            });
        }
        loadCounter();

        // Обработчики событий
        document.getElementById('clickButton').addEventListener('click', () => {
            if (!isDataLoaded) return;
            
            clickCounter++;
            updateCounterDisplay();
            saveCounter();
            
            // Анимация при клике
            createConfetti();
            document.querySelector('.character').style.transform = 'scale(1.1)';
            setTimeout(() => {
                document.querySelector('.character').style.transform = 'scale(1)';
            }, 200);
        });

        document.getElementById('resetButton').addEventListener('click', () => {
            if (!isDataLoaded) return;
            
            clickCounter = 0;
            updateCounterDisplay();
            saveCounter();
            
            // Анимация сброса
            document.querySelector('.character').style.transform = 'rotate(360deg)';
            setTimeout(() => {
                document.querySelector('.character').style.transform = 'rotate(0deg)';
            }, 500);
        });

        // Вспомогательные функции
        function updateCounterDisplay() {
            const counterElement = document.getElementById('clickCount');
            counterElement.textContent = clickCounter;
            
            // Изменение цвета при увеличении счётчика
            const hue = (clickCounter * 5) % 360;
            counterElement.style.color = `hsl(${hue}, 70%, 50%)`;
        }

        function saveCounter(callback) {
            tg.CloudStorage.setItem('clickCount', clickCounter.toString(), (error) => {
                if (error) console.error("Ошибка сохранения:", error);
                if (callback) callback();
            });
        }

        function createConfetti() {
            for (let i = 0; i < 20; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = '20%';
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.width = `${Math.random() * 10 + 5}px`;
                confetti.style.height = `${Math.random() * 10 + 5}px`;
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.style.opacity = '1';
                    confetti.style.transform = `translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 + 100}px) rotate(${Math.random() * 360}deg)`;
                    confetti.style.transition = `all ${Math.random() * 1 + 0.5}s ease-out`;
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 1000);
                }, 0);
            }
        }
    </script>
</body>
</html>